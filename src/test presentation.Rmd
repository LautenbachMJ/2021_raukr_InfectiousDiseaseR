---
title: "Project 6"
subtitle: "Analysis of infection's data "
author: "Jamirah Nazziwa, Jennie Olofsson, Julius Lautenbach, Ona Deulofeu, ZoÃ© Pochon"
institute: "RaukR 2021"
date: "2021/06/22 (updated: `r Sys.Date()`)"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/Rauk_faure.jpg/973px-Rauk_faure.jpg)

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE) 
```

class: center, top, inverse


# Expectations

???

Image credit: [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Rauk_faure.jpg)

---
background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/Zoom_participants_Bubrikh_readings_2020_conference.png/640px-Zoom_participants_Bubrikh_readings_2020_conference.png)

class: center, bottom, inverse

# Reality

???

Image credit: [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Zoom_participants_Bubrikh_readings_2020_conference.png)

---
background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/4/40/Zoom_participants_Bubrikh_readings_2020_conference.png/640px-Zoom_participants_Bubrikh_readings_2020_conference.png)

class: center, bottom, inverse


# But still a very very good course! :) 

???

Image credit: [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Zoom_participants_Bubrikh_readings_2020_conference.png)

---

# Project aim

Create package with functions that can 
- Visualize the original data
- Predict viral load values for patients 
- Generate cluster for predicted and existing values
- Visualize the groups
--
## Actual achievements 
- Visualize the original data
- Process the data
- Plot the data
- Create a workflow script using the functions but not a package
- Make a presentation

---

# Work flow

--

1. Github for the collaboration

--

2. renv for package control

--

3. tidyverse for data preparation

--

4. ggplot for data visualization

--

5. tidymodels/broom to predict parameters

--

6. rmarkdown, xaringan and css for the presentation

---

```{r, message=FALSE, warning=FALSE, echo=FALSE}
source("overview_plot.R")
source("param_parsing.R")
source("time_parsing.R")
source("time_between.R")
source("date_from.R")
source("plot_param_per_day.R")
source("visits_number.R")
source("plot_per_param_patient.R")
source("plot_patient_treatmentStatus.R")
source("create_longerdf.R")
source("norm_distr_plot.R")
source("smoothing_spline_regression.R")
source("smooth_spline_plot.R")
library(tidyverse)
library(magrittr)
```

# Input before preparing the data
```{css,echo=FALSE}
.myclass>pre>code>.remark-code-line{
  font-size: 10px;
  font-style: italic;
  background: #f8f8f8 ;
  border-radius: 2px;
}
```

```{r, echo=FALSE, message=FALSE}
input_data <- read_delim("../data/input_data.csv", delim = ";")
```

.myclass[
```{r, echo=FALSE}
str(input_data)
```
]
--

We have created functions that
1. Calculates number of days between selected columns of class Date
2. Adds column with treatment status
3. Adds column with visit number


---
# Output after data preparation
.myclass[
```{r, message=FALSE, echo=FALSE}
# extract parameter names
param_mapping <- param_parsing(input_data = input_data, input_param1 = "cd4", input_param2 = "cd8", input_param3 = "viral_load")
time_mapping <- time_parsing(input_data = input_data, on_date = "onset_date", vis_date = "visit_date", treat_date = "treatment_date")


## ============ 
## data wrangling
## ============ 
parsed_data <-
  input_data %>% 
  ## transform "_date" columns into date format
  date_from() %>% 
  ## mapping input variable names to function "under-the-hood" variables
  rename(time_mapping) %>% 
  rename(param_mapping) %>%
  ## calculate days between time points
  time_between(names(time_mapping)) %>% 
  ## calculate numbers of visits
  visits_number()

str(parsed_data)
```
]

---
# Plots 
## here are some plots



---
# Plots
## Plot parameters per days and per patient

```{r, message=FALSE, echo=FALSE}
plot_param_per_day(parsed_data, y = param1) + labs(col="Patient ID") + xlab("Days post onset") + ylab("CD4 levels")
plot_param_per_day(parsed_data, y = param2) + labs(col="Patient ID") + xlab("Days post onset") + ylab("CD8 levels")
plot_param_per_day(parsed_data, y = param3) + labs(col="Patient ID") + xlab("Days post onset") + ylab("Viral load")
```




---

# Challenges

- Resolving conflicts with Git and GitHub 

- CSS formatting of the slide presentation

- Packages impossible to install


---

