---
title: "Viral progressors"
author: "Jamirah Nazziwa, Ona Deulofeu, Jennie Olofsson, Julius Lautenbach and Zo√© Pochon"
date: '`r format(Sys.Date(), "%Y-%m-%d")`'
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
    highlight: pygments
abstract: Short project description.
knit: (function(inputFile, encoding) {
          rmarkdown::render(inputFile,
                            encoding = encoding, 
                            output_file = paste0(
                              xfun::sans_ext(inputFile), '_', Sys.Date(), '.html'),
                                output_dir = "../results/lab_book/")})
---

```{r setup, include=FALSE}
knitr::opts_knit$set(echo = TRUE, root.dir = getwd(), fig.width = 6, fig.height = 5, warning = FALSE, message = FALSE)

result.dir <- paste0("results/",Sys.Date(),"/")

## creates result.dir with date in if not existent
ifelse(isFALSE(dir.exists(paste0("../",result.dir))), dir.create(paste0("../",result.dir),recursive = TRUE),"Result directory for today exists already!")
options(stringsAsFactors = FALSE) 
```

# Viral progressors

## 1. Needed libraries
```{r message=FALSE}
library(tidyverse)
```

## 2. Data import

### 2.1 Import your data into R
```{r message=FALSE}
## to import csv files
data <- read_csv("../data/output_file.csv")
```
### 2.2. Prepare the data
```{r message=FALSE}
# Jennie's and Ona's functions here 

```

## 3. Data visualisation
### 3.1. Summary of the data
```{r message=FALSE}
summary(data)
```

## 3.2. Metric values according to site
```{r message=FALSE}
data %>% 
  tidyr::pivot_longer(where(is.numeric),names_to="metric",values_to="value") %>%
  ggplot(aes(site,value,col=site))+
    geom_violin(na.rm = TRUE)+
    facet_wrap(~metric,scales="free")
```

## 3.3. Metric values according to site
```{r message=FALSE, warning = FALSE}
library(GGally)
select(data, site, cd4, cd8, viral_load) %>%
GGally::ggpairs(mapping = ggplot2::aes(color=site))
```

## 4. Visualisation of results (our functions)

plot_param_per_day <- function(data = data, x = days_po, y, category = patient_id, treated = FALSE) 
{
ggplot(data, aes({{x}}, {{y}}, group = {{category}}, color = as.factor({{category}}))) +
  geom_smooth(na.rm = TRUE, se = FALSE, linetype = if({{treated}}) {"dashed"} else {"solid"})
}

```{r message=FALSE}
plot_param_per_day <- function(data = data, x = days_po, y, category = patient_id, treated = FALSE) 
{
ggplot(data, aes({{x}}, {{y}}, group = {{category}}, color = as.factor({{category}}))) +
  geom_smooth(na.rm = TRUE, se = FALSE, linetype = if({{treated}}) {"dashed"} else {"solid"})
}

plot_param_per_day(data, y = cd4) + labs(col="Patient ID", xlab = "Days post onset", ylab = "cd4 levels")
plot_param_per_day(data, y = cd8) + labs(col="Patient ID", xlab = "Days post onset", ylab = "cd8 levels")
plot_param_per_day(data, y = viral_load) + labs(col="Patient ID", xlab = "Days post onset", ylab = "Viral load")
```

## 5. Discussion & Comments
```{r message=FALSE}

```


## 6. SessionInfo
```{r}
## Take environment snapshot 
#renv::snapshot()

sessionInfo()
```


